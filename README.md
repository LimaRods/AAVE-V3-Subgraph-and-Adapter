# AAVE-V3-Subgraph-and-Adapter ‚õì
 Subgraph deployed to index lending-related events like borrowing, supply, repayment, and liquidations in AAVE v3 on Arbitrum and a Python adapter to extract the data in a readable format.
 You can find and test the subgraph on the [Subgraph Studio](https://thegraph.com/studio/subgraph/aave--pool-v3---arbitrum/)

 ## Tools üõ†Ô∏è
 * You can find the code used to build the subgraph as well as the graphQL schema and sources in the folder `aave--pool-v3---arbitrum`
 * `aave3_arbitrum_adapter.py` is the Python file to fetch data from the subgraph and transform it into the desired output
 * `testing_queries.ipynb` is the notebook to run some tests
 * `net_supplied_amount_previous_hour.csv` is the final output generated by the script.


## Methodology üß™
* The contract indexed by The Graph is [0x794a61358d6845594f94dc1db02a252b5b4814ad](https://miniscan.xyz/?network=arbitrum&address=0x794a61358d6845594f94dc1db02a252b5b4814ad)
* It was required to calculate the user's net supply of a specific block hourly, however, many blocks may not have Aave lending activity. Then, our approach is to aggregate events like supplies, borrows, repayments, and liquidation between the last block of the last hour and the current block available by the subgraph.
* We can utilize cron jobs or GitHub Actions to run the Python script hourly automatically

### Ideas of an optional approach
Instead of using the supply and withdraw events of the Aave pool contract, we could use the mint and burn event from aTokens and get the borrows, and repays from the pool contract. However, It took one whole day to index all history data of the contract, so using additional contracts like aTokens would take way longer time

